<!doctype html><html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no"><title>Lane Flip Sprint</title><style>body,html{margin:0;padding:0;background:#000;color:#fff;font-family:system-ui,-apple-system,sans-serif;-webkit-user-select:none;user-select:none;-webkit-touch-callout:none;-webkit-text-size-adjust:100%}*{-webkit-user-select:none;user-select:none;-webkit-touch-callout:none}#wrap{position:relative;width:100vw;height:100dvh;display:flex;align-items:center;justify-content:center;padding:60px 0 90px;box-sizing:border-box;z-index:1}canvas{background:#111;touch-action:none;border-radius:12px;width:min(92vw,360px);height:auto;max-height:70dvh;z-index:1}#hud{position:fixed;top:calc(env(safe-area-inset-top,0px) + 6px);left:0;right:0;text-align:center;font-size:14px;opacity:.9;z-index:2;pointer-events:none}#controls{position:fixed;left:0;right:0;bottom:calc(env(safe-area-inset-bottom,0px) + 8px);display:flex;justify-content:center;gap:8px;padding:10px 16px;box-sizing:border-box;flex-wrap:wrap;z-index:3}button{padding:10px 14px;border:none;border-radius:10px;background:#222;color:#fff;touch-action:manipulation;-webkit-user-select:none;user-select:none}button:active{transform:scale(.98)}#startOverlay{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,.8);z-index:10}#startOverlay.hidden{display:none}#startOverlay .panel{background:#0b132b;border:1px solid rgba(255,255,255,.1);padding:20px 22px;border-radius:14px;text-align:center;min-width:220px}#startOverlay .title{font-size:18px;margin-bottom:6px}#startOverlay .subtitle{font-size:12px;opacity:.8;margin-bottom:14px}</style></head><body><div id="hud">Score: <span id="score">0</span> Â· Best: <span id="best">0</span></div><div id="wrap"><canvas id="game" width="360" height="640"></canvas></div><div id="controls"><button id="restart">Restart</button> <button id="revive" disabled="disabled">Revive (Rewarded)</button> <button id="audio">Audio: On</button></div><div id="startOverlay"><div class="panel"><div class="title">Tap To Start</div><div class="subtitle">Audio will start after your tap</div><button id="startBtn">Start</button></div></div><script>const bridge={send(e,t={}){window.parent?.postMessage({type:e,payload:t},"*")},on(e,t){window.addEventListener("message",n=>{n.data&&n.data.type===e&&t(n.data.payload||{})})}};bridge.on("INTERSTITIAL_CLOSED",()=>{}),bridge.on("REWARDED_GRANTED",e=>{"revive"===e.rewardType&&doRevive()}),bridge.on("REWARDED_DENIED",()=>{});const canvas=document.getElementById("game"),ctx=canvas.getContext("2d"),scoreEl=document.getElementById("score"),bestEl=document.getElementById("best"),restartBtn=document.getElementById("restart"),reviveBtn=document.getElementById("revive"),audioBtn=document.getElementById("audio"),controlsEl=document.getElementById("controls"),startOverlay=document.getElementById("startOverlay"),startBtn=document.getElementById("startBtn");function handleInput(e){startAudioIfNeeded(),running&&(player.lane=1-player.lane,audioOn&&sfxTap())}function isControlTarget(e){return!!(e&&e.closest&&e.closest("#controls"))}function onGlobalInput(e){isControlTarget(e.target)||waitingForStart||(e.cancelable&&e.preventDefault(),handleInput(e))}function bridgeAvailable(){return!!(window.AndroidBridge||window.webkit&&window.webkit.messageHandlers&&window.webkit.messageHandlers.iOSBridge)}function onReviveRequested(){startAudioIfNeeded(),bridgeAvailable()?bridge.send("REQUEST_REWARDED",{reason:"revive"}):doRevive()}function onRestartRequested(){startAudioIfNeeded(),reset()}function onAudioToggle(){audioOn=!audioOn,audioBtn.textContent=audioOn?"Audio: On":"Audio: Off",audioOn?startAudioIfNeeded():audioCtx&&"running"===audioCtx.state&&audioCtx.suspend()}const lanes=[.33*canvas.width,.67*canvas.width],player={lane:0,y:canvas.height-90,r:18},obstacles=[];let running=!1,score=0,best=Number(localStorage.getItem("best")||0),startMs=0,dead=!1,canRevive=!1,invincibleMs=0,spawnTimer=0,lastMs=0,audioOn=!0,waitingForStart=!0,audioCtx=null,musicTimer=0,musicStep=0;function startAudioIfNeeded(){return!!audioOn&&(audioCtx||(audioCtx=new(window.AudioContext||window.webkitAudioContext)),"suspended"===audioCtx.state&&audioCtx.resume(),!0)}function ensureAudio(){audioCtx||(audioCtx=new(window.AudioContext||window.webkitAudioContext)),"suspended"===audioCtx.state&&audioCtx.resume()}function tone(e,t=.08,n=.05,a="sine"){if(!audioCtx)return;const i=audioCtx.currentTime,o=audioCtx.createOscillator(),s=audioCtx.createGain();o.type=a,o.frequency.value=e,s.gain.value=1e-4,o.connect(s),s.connect(audioCtx.destination),o.start(i),s.gain.exponentialRampToValueAtTime(n,i+.01),s.gain.exponentialRampToValueAtTime(1e-4,i+t),o.stop(i+t+.02)}function sfxTap(){tone(420,.05,.06,"triangle")}function sfxScore(){tone(640,.06,.05,"sine")}function sfxHit(){tone(140,.12,.07,"square")}const musicSeq=[196,0,220,0,196,0,246,0,196,0,220,0,196,0,174,0];function updateMusic(e){if(!audioOn)return;if(!audioCtx)return;const t=Math.max(.12,.22-.003*Math.min(score,30));if(musicTimer-=e,musicTimer<=0){musicTimer=t;const e=musicSeq[musicStep%musicSeq.length];e>0&&tone(e,.8*t,.03,"sawtooth"),musicStep++}}function reset(){running=!0,dead=!1,canRevive=!1,reviveBtn.disabled=!0,score=0,scoreEl.textContent="0",obstacles.length=0,spawnTimer=0,invincibleMs=0,startMs=performance.now(),lastMs=performance.now(),bridge.send("GAME_START",{}),audioOn&&ensureAudio()}function showStartOverlay(){waitingForStart=!0,running=!1,dead=!1,canRevive=!1,reviveBtn.disabled=!0,startOverlay.classList.remove("hidden")}function hideStartOverlay(){waitingForStart=!1,startOverlay.classList.add("hidden")}function gameOver(){if(dead)return;dead=!0,running=!1;const e=Math.max(0,performance.now()-startMs);bridge.send("GAME_OVER",{score:score,durationMs:e}),canRevive=!0,reviveBtn.disabled=!1,bridge.send("REQUEST_INTERSTITIAL",{reason:"game_over"}),score>best&&(best=score,localStorage.setItem("best",String(best)),bestEl.textContent=best),audioOn&&sfxHit()}function doRevive(){if(canRevive){canRevive=!1,reviveBtn.disabled=!0,running=!0,dead=!1,invincibleMs=1500;for(let e=obstacles.length-1;e>=0;e--)obstacles[e].y>player.y-120&&obstacles.splice(e,1)}}function spawnObstacle(){const e=Math.random()<.5?0:1;obstacles.push({lane:e,y:-30,w:80,h:26})}function update(e){if(!running||waitingForStart)return;if(updateMusic(e),spawnTimer-=e,spawnTimer<=0){const e=Math.max(.45,.75-.008*Math.min(score,40));spawnTimer=e,spawnObstacle()}const t=260+12*score;for(let n=obstacles.length-1;n>=0;n--){const a=obstacles[n];if(a.y+=t*e,a.y-a.h/2>canvas.height+10)obstacles.splice(n,1),score+=1,scoreEl.textContent=String(score),audioOn&&sfxScore();else if(a.lane===player.lane&&invincibleMs<=0){Math.abs(a.y-player.y)<a.h/2+player.r&&gameOver()}}invincibleMs>0&&(invincibleMs-=1e3*e)}function draw(){ctx.clearRect(0,0,canvas.width,canvas.height);const e=.001*performance.now(),t=ctx.createLinearGradient(0,0,0,canvas.height);t.addColorStop(0,"#0b132b"),t.addColorStop(1,"#1b263b"),ctx.fillStyle=t,ctx.fillRect(0,0,canvas.width,canvas.height),ctx.strokeStyle="rgba(255,255,255,0.08)",ctx.lineWidth=2;for(let t=0;t<6;t++){const n=(t+1)*canvas.width/7,a=(140*e+120*t)%canvas.height;ctx.beginPath(),ctx.moveTo(n,a),ctx.lineTo(n,a+80),ctx.stroke()}ctx.strokeStyle="#222",ctx.lineWidth=2,ctx.beginPath(),ctx.moveTo(canvas.width/2,0),ctx.lineTo(canvas.width/2,canvas.height),ctx.stroke();for(const e of obstacles){ctx.fillStyle="#e74c3c";const t=lanes[e.lane]-e.w/2,n=e.y-e.h/2;ctx.fillRect(t,n,e.w,e.h)}ctx.fillStyle=invincibleMs>0?"#f1c40f":"#4aa3ff",ctx.beginPath(),ctx.arc(lanes[player.lane],player.y,player.r,0,2*Math.PI),ctx.fill();const n=ctx.createRadialGradient(canvas.width/2,canvas.height/2,50,canvas.width/2,canvas.height/2,canvas.width);n.addColorStop(0,"rgba(0,0,0,0)"),n.addColorStop(1,"rgba(0,0,0,0.45)"),ctx.fillStyle=n,ctx.fillRect(0,0,canvas.width,canvas.height),dead&&(ctx.fillStyle="#fff",ctx.font="20px system-ui, sans-serif",ctx.fillText("Game Over",canvas.width/2-55,canvas.height/2),ctx.font="14px system-ui, sans-serif",ctx.fillText("Tap Restart or Revive",canvas.width/2-70,canvas.height/2+24))}function loop(e){const t=Math.min(.032,(e-lastMs)/1e3);lastMs=e,update(t),draw(),requestAnimationFrame(loop)}bestEl.textContent=best,reviveBtn.addEventListener("click",onReviveRequested),restartBtn.addEventListener("click",onRestartRequested),audioBtn.addEventListener("click",onAudioToggle),startBtn.addEventListener("click",()=>{hideStartOverlay(),startAudioIfNeeded(),reset()}),controlsEl.addEventListener("pointerdown",e=>e.stopPropagation()),controlsEl.addEventListener("touchstart",e=>e.stopPropagation(),{passive:!1}),controlsEl.addEventListener("mousedown",e=>e.stopPropagation()),reviveBtn.addEventListener("pointerdown",e=>{e.preventDefault(),onReviveRequested()}),reviveBtn.addEventListener("touchstart",e=>{e.preventDefault(),onReviveRequested()},{passive:!1}),reviveBtn.addEventListener("mousedown",e=>{e.preventDefault(),onReviveRequested()}),restartBtn.addEventListener("pointerdown",e=>{e.preventDefault(),onRestartRequested()}),restartBtn.addEventListener("touchstart",e=>{e.preventDefault(),onRestartRequested()},{passive:!1}),restartBtn.addEventListener("mousedown",e=>{e.preventDefault(),onRestartRequested()}),audioBtn.addEventListener("pointerdown",e=>{e.preventDefault(),onAudioToggle()}),audioBtn.addEventListener("touchstart",e=>{e.preventDefault(),onAudioToggle()},{passive:!1}),audioBtn.addEventListener("mousedown",e=>{e.preventDefault(),onAudioToggle()}),canvas.addEventListener("pointerdown",e=>{e.preventDefault(),handleInput(e)}),canvas.addEventListener("touchstart",e=>{e.preventDefault(),handleInput(e)},{passive:!1}),canvas.addEventListener("mousedown",e=>{e.preventDefault(),handleInput(e)}),window.addEventListener("pointerdown",onGlobalInput),window.addEventListener("touchstart",onGlobalInput,{passive:!1}),window.addEventListener("mousedown",onGlobalInput),requestAnimationFrame(loop),showStartOverlay(),document.addEventListener("contextmenu",e=>e.preventDefault()),document.addEventListener("selectstart",e=>e.preventDefault())</script></body></html>